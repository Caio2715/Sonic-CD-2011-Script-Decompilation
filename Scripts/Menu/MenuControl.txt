//------------Sonic CD Menu Control Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

//-------Aliases-------//
#alias Object.Value0 : Object.Fade
#alias Object.Value1 : Object.ButtonYOffset
#alias Object.Value2 : Object.DragCurrentSelection
#alias Object.Value3 : Object.CurrentSelection
#alias Object.Value4 : Object.ButtonScroll
#alias Object.Value5 : Object.DragEnabled
#alias Object.Value6 : Object.DragYOffset
#alias Object.Value7 : Object.DragSmooth

//-------States--------//
#alias 0 : MENUCONTROL_SETUP
#alias 1 : MENUCONTROL_BUTTONS_MOVEIN
#alias 2 : MENUCONTROL_CONTROLS
#alias 3 : MENUCONTROL_BLANK
#alias 4 : MENUCONTROL_ENTER_TIMEATTACK
#alias 5 : MENUCONTROL_ENTER_DEMO
#alias 6 : MENUCONTROL_MENUBUTTON_CHECK
#alias 7 : MENUCONTROL_ENTER_TROPHIES
#alias 8 : MENUCONTROL_ENTER_LEADERBOARS


//Object[1] is a blank object only used to share values across the menu objects

//Object[1].Value0 and Object[1].Value1 are edited in MenuControl (you are currently here)

//Object[1].Value2 comes from MenuButton and sets the maximum amount of button to move around
//Object[1].Value3 comes from MenuButton and what it does i'll leave you to you imagination

//Object[1].Value4 gets values from most of the "Menu" Objects
//Object[1].Value5 and Object[1].Value6 get their values set by TrophiesMenu

sub ObjectMain

	switch Object.State
	case MENUCONTROL_SETUP
		Object.State = MENUCONTROL_BUTTONS_MOVEIN
		Object.Fade = 384
		SetScreenFade(0, 0, 0, 255)
		PlayMusic(Options.Soundtrack)
		if Engine.FrameSkipTimer > -1
			Engine.FrameSkipTimer = -1
		end if
		break

	case MENUCONTROL_BUTTONS_MOVEIN
		if Object.Fade > 0
			Object.Fade -= 8
		else
			Object.State = MENUCONTROL_MENUBUTTON_CHECK
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	case MENUCONTROL_CONTROLS
		#platform: Mobile
			CheckEqual(Options.PhysicalControls,1)
		#endplatform

		#platform: Standard
			CheckResult = 1
		#endplatform

		if CheckResult == 1
			if KeyPress.Up == 1
				Object.CurrentSelection--
				if Object.CurrentSelection < 1
					Object.CurrentSelection = 1
				else
					PlaySfx(23, 0)
				end if
			end if
			if KeyPress.Down == 1
				Object.CurrentSelection++
				if Object.CurrentSelection > Object[1].Value2
					Object.CurrentSelection = Object[1].Value2
				else
					PlaySfx(23, 0)
				end if
			end if
			TempValue0 = Object.CurrentSelection
			TempValue0 -= Object.ButtonScroll
			if TempValue0 < 1
				Object.ButtonScroll--
				Object.Direction = 3
			end if
			if TempValue0 > 4
				Object.ButtonScroll++
				Object.Direction = FACING_RIGHT
			end if
			TempValue0 = Object.Value1
			TempValue0 -= 32
			TempValue1 = Object.ButtonScroll
			TempValue1 *= -60
			TempValue1 -= TempValue0
			TempValue1 += Object.Direction
			TempValue1 >>= 2
			Object.Value1 += TempValue1
		end if
#platform: Mobile
		if Options.PhysicalControls == 1
			CheckTouchRect(0, 0, Screen.XSize, Screen.YSize)
			if CheckResult > -1
				Options.PhysicalControls = 0
				Object.CurrentSelection = 0
				Object.Value2 = 0
			end if
		else
			if Engine.Message == 2
				Object.CurrentSelection = 0
				Object.Value2 = 0
			end if
			if Object.Value2 > 0
				Object.CurrentSelection = Object.Value2
			else
				Object.CurrentSelection = 0
			end if
			if Object[1].Value2 > 4
				CheckTouchRect(0, 0, Screen.XSize, Screen.YSize)
				if CheckResult > -1
					ArrayPos0 = CheckResult
					if Object.DragEnabled == 0
						Object.DragEnabled = 1
						Object[1].Value0 = Object.Value1
						Object.DragYOffset = TouchScreen[ArrayPos0].YPos
					else
						TempValue0 = TouchScreen[ArrayPos0].YPos
						TempValue0 -= Object.DragYOffset
						TempValue0 += Object[1].Value0
						Object[1].Value6 = Object[1].Value5
						Object[1].Value5 = Object[1].Value4
						Object[1].Value4 = Object.DragSmooth
						Object.DragSmooth = TempValue0
						Object.DragSmooth -= Object.Value1
						Object.Value1 = TempValue0
					end if
					TempValue0 = Object.DragSmooth
					TempValue0 >>= 2
					if TempValue0 != 0
						Object.CurrentSelection = 0
						Object.Value2 = 0
					end if
				else
					if Object.DragEnabled == 1
						Object.DragEnabled = 0
						Object.DragYOffset = Object.Value1
						Object.DragYOffset <<= 8
						Object.DragSmooth += Object[1].Value4
						Object.DragSmooth += Object[1].Value5
						Object.DragSmooth += Object[1].Value6
						Object.DragSmooth >>= 2
						Object.DragSmooth <<= 7
						if Object.DragSmooth == 0
							if Object.CurrentSelection == 0
								Object.DragSmooth = 1
							end if
						end if
					end if
					if Object.DragSmooth != 0
						Object.DragYOffset += Object.DragSmooth
						if Object.DragYOffset < Object[1].Value3
							Object.DragYOffset = Object[1].Value3
							Object.DragSmooth = 0
						end if
						if Object.DragYOffset > 23040
							Object.DragYOffset = 23040
							Object.DragSmooth = 0
						end if
						if Object.DragSmooth > 0
							Object.DragSmooth -= 32
							if Object.DragSmooth < 0
								Object.DragSmooth = 0
							end if
						else
							Object.DragSmooth += 32
							if Object.DragSmooth > 0
								Object.DragSmooth = 0
							end if
						end if
						Object.Value1 = Object.DragYOffset
						Object.Value1 >>= 8
						//This re-centers the dragging based on the current button on top of the screen
						if Object.DragSmooth == 0
							Object.ButtonScroll = Object.Value1
							Object.ButtonScroll -= 32
							Object.ButtonScroll /= -60
							if Object.ButtonScroll < 0
								Object.ButtonScroll = 0
							end if
							TempValue0 = Object[1].Value2
							TempValue0 -= 4
							if Object.ButtonScroll > TempValue0
								Object.ButtonScroll = TempValue0
							end if
						end if
					else
						TempValue0 = Object.Value1
						TempValue0 -= 32
						Object[1].Value1 = Object.Value4
						Object[1].Value1 *= -60
						Object[1].Value1 -= TempValue0
						Object[1].Value1 >>= 2
						if Object[1].Value1 < -4
							Object[1].Value1 = -4
						end if
						if Object[1].Value1 > 4
							Object[1].Value1 = 4
						end if
						Object.Value1 += Object[1].Value1
					end if
				end if
			end if
			if KeyPress.Up == 1
				Object.CurrentSelection = Object[1].Value2
				Options.PhysicalControls = 1
			end if
			if KeyPress.Down == 1
				Object.CurrentSelection = 1
				Options.PhysicalControls = 1
			end if
		end if
#endplatform
		break

	case MENUCONTROL_BLANK //Used to stop the controls temporarily
		break

	case MENUCONTROL_ENTER_TIMEATTACK
		if Object.Fade < 320
			Object.Fade += 8
		else
			Stage.ListPos = 2
			LoadStage()
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	case MENUCONTROL_ENTER_DEMO	//Only used in Demo versions of the game
		if Object.Fade < 320
			Object.Fade += 8
		else
#platform: Mobile
			if Engine.PlatformID != RETRO_WP7
				if Options.Soundtrack == 0
					LoadVideo("Opening")
				else
					LoadVideo("OpeningUS")
				end if
			end if
#endplatform
			Stage.ActiveList = REGULAR_STAGE
			Stage.ListPos = 0
			LoadStage()
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	case MENUCONTROL_MENUBUTTON_CHECK
		if Object[34].State == 2
			Object.State = MENUCONTROL_CONTROLS
		end if
		break

	case MENUCONTROL_ENTER_TROPHIES		//Mobile Only
		#platform: Mobile
			if Object.Fade < 320
				Object.Fade += 8
			else
				Stage.ListPos = 9
				LoadStage()
			end if
			SetScreenFade(0, 0, 0, Object.Fade)
		#endplatform
		break

	case MENUCONTROL_ENTER_LEADERBOARS	//Mobile Only
		#platform: Mobile
			if Object.Fade < 320
				Object.Fade += 8
			else
				Stage.ListPos = 10
				LoadStage()
			end if
			SetScreenFade(0, 0, 0, Object.Fade)
		#endplatform
		break

	end switch
end sub


sub ObjectStartup
	SetMusicTrack("JP/SpecialStage.ogg", 0, 1)
	SetMusicTrack("US/SpecialStage.ogg", 1, 270972)
	Object[0].Type = TypeName[MenuControl]
	Object[0].ButtonYOffset = 32
#platform: Standard
	Object[0].CurrentSelection = 1
#endplatform
#platform: Mobile
	Options.PhysicalControls = 0
#endplatform
	Object[0].DragCurrentSelection = 0
end sub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0, SingleIcon, -16, -16, 32, 32, 1, 143)
end sub
