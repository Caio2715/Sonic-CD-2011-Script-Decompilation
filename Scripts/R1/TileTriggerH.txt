//------------Sonic CD Tile Trigger H Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// This is a chunk swapper for loops

// Aliases
#alias Object.Value0	:	OBject.HitboxLeft
#alias Object.Value1	:	OBject.HitboxRight
#alias Object.Value2	:	OBject.ChunkX
#alias Object.Value3	:	OBject.ChunkY
#alias Object.Value4	:	OBject.NextChunkX
#alias Object.Value5	:	OBject.NextChunkY
#alias Object.Value6	:	OBject.OriginalChunk
#alias Object.Value7	:	OBject.NextChunk


sub ObjectPlayerInteraction
	PlayerObjectCollision(C_TOUCH, Object.HitboxLeft, -12, Object.HitboxRight, 12)
	if CheckResult == true
	
		if Object[+1].PropertyValue == 0
			TempValue0 = Object.OriginalChunk
		else
			TempValue0 = Object.NextChunk
		end if
		SetTileLayerEntry(TempValue0, 0, Object.ChunkX, Object.ChunkY)
		TempValue0++

		SetTileLayerEntry(TempValue0, 0, Object.NextChunkX, Object.ChunkY)
		TempValue0++

		SetTileLayerEntry(TempValue0, 0, Object.ChunkX, Object.NextChunkY)
		TempValue0++

		SetTileLayerEntry(TempValue0, 0, Object.NextChunkX, Object.NextChunkY)
		TempValue0++
	end if
end sub


sub ObjectStartup
	ArrayPos0 = 32
	while ArrayPos0 < 1056
		if Object[ArrayPos0].Type == TypeName[TileTriggerH]
			ArrayPos1 = ArrayPos0
			ArrayPos1++	// This should always be a blank object
			Object[ArrayPos0].HitboxLeft = Object[ArrayPos0].PropertyValue
			Object[ArrayPos0].HitboxLeft <<= 3
			Object[ArrayPos0].HitboxRight = Object[ArrayPos0].HitboxLeft
			FlipSign(Object[ArrayPos0].HitboxLeft)
			Object[ArrayPos0].HitboxLeft -= 8
			Object[ArrayPos0].HitboxRight += 8

			Object[ArrayPos0].ChunkX = Object[ArrayPos1].iXPos
			Object[ArrayPos0].ChunkX >>= 7

			Object[ArrayPos0].NextChunkX = Object[ArrayPos0].ChunkX
			Object[ArrayPos0].NextChunkX++

			Object[ArrayPos0].ChunkY = Object[ArrayPos1].iYPos
			Object[ArrayPos0].ChunkY >>= 7

			Object[ArrayPos0].NextChunkY = Object[ArrayPos0].ChunkY
			Object[ArrayPos0].NextChunkY++

			GetTileLayerEntry(Object[ArrayPos0].OriginalChunk, 0, Object[ArrayPos0].ChunkX, Object[ArrayPos0].ChunkY)

			Object[ArrayPos0].NextChunk = Object[ArrayPos0].OriginalChunk
			Object[ArrayPos0].NextChunk += 4
		end if
		ArrayPos0++
	loop
end sub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0, SingleIcon, -16, -16, 32, 32, 1, 143)
end sub
