//------------Sonic CD TouchStart/Start Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias Object.Value0 : Object.Fade
#alias Object.Value1 : Object.StageSelectCheatPos
#alias Object.Value2 : Object.SoundTestCheatPos
#alias Object.Value3 : Object.DemoTimer

//-------States--------//
#alias 0 : START_SETUP
#alias 1 : STAGE_GOTO_MENU
#alias 2 : STAGE_GOTO_STAGESELECT
#alias 3 : STAGE_GOTO_SOUNDTEST
#alias 4 : STAGE_GOTO_DEMO

//--Callbacks & Engine States--//
#alias 1  : CALLBACK_PRESS_START
#alias 7  : CALLBACK_EXIT_SELECTED
#alias 16 : CALLBACK_MOREGAMES

//--------Languages--------//
#alias 0 : ENGLISH
#alias 1 : FRENCH
#alias 2 : ITALIAN
#alias 3 : DEUTSCH
#alias 4 : SPANISH
#alias 5 : JAPANESE

#function TouchStart_HandleCheatCode	//Entirely functional yet unused

function TouchStart_HandleCheatCode
	TempValue0 = 0
	if KeyPress.Up == 1
		TempValue0 = 1
	end if
	if KeyPress.Down == 1
		TempValue0 = 2
	end if
	if KeyPress.Left == 1
		TempValue0 = 3
	end if
	if KeyPress.Right == 1
		TempValue0 = 4
	end if
	if KeyPress.ButtonA == 1
		TempValue0 = 5
	end if
	if KeyPress.ButtonB == 1
		TempValue0 = 6
	end if
	if KeyPress.ButtonC == 1
		TempValue0 = 7
	end if
	switch Object.StageSelectCheatPos	// UP - DOWN - DOWN - LEFT - RIGHT - B
	case 0
		if TempValue0 == 1
			Object.StageSelectCheatPos++
		else
			if TempValue0 != 0
				Object.StageSelectCheatPos = 0
			end if
		end if
		break

	case 1
		if TempValue0 == 2
			Object.StageSelectCheatPos++
		else
			if TempValue0 != 0
				Object.StageSelectCheatPos = 0
			end if
		end if
		break

	case 2
		if TempValue0 == 2
			Object.StageSelectCheatPos++
		else
			if TempValue0 != 0
				Object.StageSelectCheatPos = 0
			end if
		end if
		break

	case 3
		if TempValue0 == 3
			Object.StageSelectCheatPos++
		else
			if TempValue0 != 0
				Object.StageSelectCheatPos = 0
			end if
		end if
		break

	case 4
		if TempValue0 == 4
			Object.StageSelectCheatPos++
		else
			if TempValue0 != 0
				Object.StageSelectCheatPos = 0
			end if
		end if
		break

	case 5
		if TempValue0 == 6
			Object.StageSelectCheatPos = 0
			Object.State = STAGE_GOTO_STAGESELECT
			StopMusic()
			PlaySfx(1, 0)	//	Ring SFX
		else
			if TempValue0 != 0
				Object.StageSelectCheatPos = 0
			end if
		end if
		break

	end switch

	switch Object.SoundTestCheatPos	// DOWN - DOWN - DOWN - LEFT - RIGHT - A
	case 0
		if TempValue0 == 2
			Object.SoundTestCheatPos++
		else
			if TempValue0 != 0
				Object.SoundTestCheatPos = 0
			end if
		end if
		break

	case 1
		if TempValue0 == 2
			Object.SoundTestCheatPos++
		else
			if TempValue0 != 0
				Object.SoundTestCheatPos = 0
			end if
		end if
		break

	case 2
		if TempValue0 == 2
			Object.SoundTestCheatPos++
		else
			if TempValue0 != 0
				Object.SoundTestCheatPos = 0
			end if
		end if
		break

	case 3
		if TempValue0 == 3
			Object.SoundTestCheatPos++
		else
			if TempValue0 != 0
				Object.SoundTestCheatPos = 0
			end if
		end if
		break

	case 4
		if TempValue0 == 4
			Object.SoundTestCheatPos++
		else
			if TempValue0 != 0
				Object.SoundTestCheatPos = 0
			end if
		end if
		break

	case 5
		if TempValue0 == 5
			Object.SoundTestCheatPos = 0
			Object.State = STAGE_GOTO_SOUNDTEST
			StopMusic()
			PlaySfx(1, 0)	//	Ring SFX
		else
			if TempValue0 != 0
				Object.SoundTestCheatPos = 0
			end if
		end if
		break

	end switch
end function


sub ObjectMain
	switch Object.State
	case START_SETUP
#platform: Standard
		CheckEqual(KeyPress.AnyStart,1)
#endplatform

#platform: Mobile
		CheckTouchRect(0, 0, Screen.XSize, 240)
		if KeyPress.Start == 1
			CheckResult = 0
		end if
		CheckGreater(CheckResult,-1)
#endplatform   
		if CheckResult == 1
			Object.State = STAGE_GOTO_MENU
			StopMusic()
			PlaySfx(27, 0)	//	Select SFX
#platform: Use_Haptics
			HapticEffect(31, 0, 0, 0)
#endplatform

#platform: Standard
			EngineCallback(CALLBACK_PRESS_START)
#endplatform
		else
			Object.DemoTimer++
			if Object.DemoTimer == 1550
				Object.State = STAGE_GOTO_DEMO
			end if
		end if

#platform: Mobile
		if Engine.PlatformID == RETRO_WP7
			if KeyPress.ButtonB == 1
				EngineCallback(CALLBACK_EXIT_SELECTED)
			end if
		end if
#endplatform
		break

	case STAGE_GOTO_MENU
		Object.Fade += 4
#platform: Standard
		if Object.Fade == 380
			EngineCallback(CALLBACK_MOREGAMES)	//	SONIC DASH PLAY NOW!
		end if
#endplatform
		if Object.Fade == 384
			Stage.ListPos = 1		//	Menu
			LoadStage()
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	case STAGE_GOTO_STAGESELECT
		Object.Fade += 4
		if Object.Fade == 384
			Options.GameMode = 0
			Stage.ListPos = 3	//	Stage Select
			LoadStage()
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	case STAGE_GOTO_SOUNDTEST
		Object.Fade += 4
		if Object.Fade == 384
			Options.GameMode = 0
			Stage.ListPos = 4	//	Sound Test
			LoadStage()
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	case STAGE_GOTO_DEMO
		Object.Fade += 4
		if Object.Fade == 384
#platform: Use_Haptics
			Engine.HapticsEnabled = 0
#endplatform
#platform: Mobile
			Fade_Colour = 0
#endplatform
			Player.Score = 0
			Player.Lives = 3
			Player.ScoreBonus = 50000
			Transporter_Destroyed = 0
			MetalSonic_Destroyed = 0
			Good_Future = 0
			Options.GameMode = 0
			Options.AttractMode = 1
#platform: Mobile
			if Engine.PlatformID == RETRO_ANDROID
				if Engine.TrialMode == 1
					Options.DemoNumber = 0
				end if
			end if
#endplatform
			switch Options.DemoNumber
			case 0
				Stage.ActiveList = REGULAR_STAGE
				Stage.ListPos = 0	//	Palmtree Panic 1 Present
				break

			case 1
				Stage.ActiveList = SPECIAL_STAGE
				Stage.ListPos = 0	//	Special Stage 1
				break

			case 2
				Stage.ActiveList = REGULAR_STAGE
				Stage.ListPos = 28	//	Tidal Tempest 3 Good Future
				break

			case 3
				Stage.ActiveList = SPECIAL_STAGE
				Stage.ListPos = 5	//	Special Stage 5
				break

			case 4
				Stage.ActiveList = REGULAR_STAGE
				Stage.ListPos = 64	//	Metallic Madness 2 Present
				break

			end switch
			Options.DemoNumber++
			Options.DemoNumber %= 5
			LoadStage()
		end if
		SetScreenFade(0, 0, 0, Object.Fade)
		break

	end switch
end sub


sub ObjectDraw
	Object.AnimationTimer++
	if Object.AnimationTimer > 59
		Object.AnimationTimer = 0
	end if
	if Object.AnimationTimer > 29
		DrawSprite(0)
	end if
end sub


sub ObjectStartup
	LoadSpriteSheet("Title/Title.gif")
#platform: Standard
	switch Engine.Language
	case ENGLISH
	case JAPANESE
		SpriteFrame(-43, 0, 87, 11, 106, 103)	//	English Press Start
		break

	case FRENCH
		SpriteFrame(-60, 0, 120, 11, 391, 387)	//	French Press Start
		break

	case ITALIAN
		SpriteFrame(-44, 0, 88, 11, 270, 411)	//	Italian Press Start
		break
		
	case DEUTSCH
		SpriteFrame(-52, -2, 106, 13, 405, 373)	//	Deutsch Press Start
		break

	case SPANISH
		SpriteFrame(-43, 0, 87, 11, 274, 435)	//	Spanish Press Start
		break

	end switch
#endplatform

#platform: Mobile
	switch Engine.Language
	case ENGLISH
	case JAPANESE
		SpriteFrame(-56, 0, 117, 11, 106, 91)	//	English Touch to Start
		break

	case FRENCH
		SpriteFrame(-94, 0, 189, 11, 322, 399)	//	French Touch to Start
		break

	case ITALIAN
		SpriteFrame(-76, 0, 152, 11, 359, 411)	//	Italian Touch To Start
		break

	case DEUTSCH
		SpriteFrame(-87, 0, 175, 11, 336, 423)	//	Deutsch Touch to Start
		break

	case SPANISH
		SpriteFrame(-74, 0, 149, 11, 362, 435)	//	Spanish Touch To Start
		break

	end switch
#endplatform
end sub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0, SingleIcon, -16, -16, 32, 32, 1, 143)
end sub
