//------------Sonic CD Effect Trigger Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Property Values

// Level
#alias 0	:	EFFECTRIGGER_SET_BG_LAYER
#alias 1	:	EFFECTRIGGER_SWAP_BACKGROUND
#alias 2	:	EFFECTRIGGER_WATER_HEIGHT
#alias 13	:	EFFECTRIGGER_WATER_HEIGHT_2	// not sure if this is used

// Pipes
#alias 4	:	EFFECTRIGGER_PIPE_BOTTOM_ENTRY
#alias 5	:	EFFECTRIGGER_PIPE_TOP_ENTRY
#alias 6	:	EFFECTRIGGER_PIPE_TURN_LEFT
#alias 7	:	EFFECTRIGGER_PIPE_TURN_RIGHT
#alias 8	:	EFFECTRIGGER_PIPE_TURN_UP
#alias 9	:	EFFECTRIGGER_PIPE_TURN_DOWN
#alias 10	:	EFFECTRIGGER_UNUSED
#alias 11	:	EFFECTRIGGER_UNUSED_2
#alias 12	:	EFFECTRIGGER_PIPE_EXIT_PIPE


sub ObjectMain
	switch Object.PropertyValue
	case EFFECTRIGGER_SET_BG_LAYER
		if Player.XPos < 41943040		// 0x2800000, X - 640 in map coords
			Stage[0].ActiveLayer = 1	// why it does this instead of starting with this layer directly? no clue
			
			Object.Type 	= TypeName[Blank Object]
			Object[19].Type = TypeName[BGAnimation]
		end if
		break

	case EFFECTRIGGER_SWAP_BACKGROUND
		if Player.YPos > Object.YPos
			Stage[0].ActiveLayer = 2

			Object[19].Type = TypeName[BGAnimation]
		else
			Stage[0].ActiveLayer = 1

			Object[19].Type = TypeName[BGAnimation]
		end if
		break

	case EFFECTRIGGER_WATER_HEIGHT
		if Player.XPos > Object.XPos
			Stage.NewWaterLevel = 40108032	// 0x2640000, Y - 612 in map coords
		else
			Stage.NewWaterLevel = 42205184	// 0x2840000, Y - 644 in map coords
		end if
		break

	case EFFECTRIGGER_PIPE_BOTTOM_ENTRY
		PlayerObjectCollision(C_TOUCH, -10, -16, 10, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
#platform: Mobile
					Warp.Timer = 0
#endplatform
					Player.State = PlayerObject_DebugMode
					Player.Animation = ANI_FANROTATE

					Player.XVelocity = 0
					Player.YVelocity = -262144	//-0x40000

					if Player.XPos < Object.XPos
						Player.XPos += 65536	// 0x10000
					else
						Player.XPos -= 65536	// 0x10000
					end if
				end if
			end if
		else
			if Player.State == PlayerObject_DebugMode
				PlayerObjectCollision(C_TOUCH, -64, -16, -32, 16)
				if CheckResult == true
					Player.State 	 = PlayerObject_HandleAir
					Player.Animation = ANI_WALKING
				end if

				PlayerObjectCollision(C_TOUCH, 32, -16, 64, 16)
				if CheckResult == true
					Player.State 	 = PlayerObject_HandleAir
					Player.Animation = ANI_WALKING
				end if
			end if
		end if
		break

	case EFFECTRIGGER_PIPE_TOP_ENTRY
		PlayerObjectCollision(C_TOUCH, -10, -16, 10, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
#platform: Mobile
					Warp.Timer = 0
#endplatform
					Player.State 	 = PlayerObject_DebugMode
					Player.Animation = ANI_FANROTATE

					Player.XVelocity = 0
					Player.YVelocity = 262144	// 0x40000

					if Player.XPos < Object.XPos
						Player.XPos += 65536	// 0x10000
					else
						Player.XPos -= 65536	// 0x10000
					end if
				end if
			end if
		else
			if Player.State == PlayerObject_DebugMode
				PlayerObjectCollision(C_TOUCH, -64, -16, -32, 16)
				if CheckResult == true
					Player.State 	 = PlayerObject_HandleGround
					Player.Animation = ANI_WALKING
				end if
				
				PlayerObjectCollision(C_TOUCH, 32, -16, 64, 16)
				if CheckResult == true
					Player.State 	 = PlayerObject_HandleGround
					Player.Animation = ANI_WALKING
				end if
			end if
		end if
		break

	case EFFECTRIGGER_PIPE_TURN_LEFT
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.XVelocity = -262144	// -0x40000
					Player.Animation = ANI_FANROTATE
				end if
			end if
		end if
		break

	case EFFECTRIGGER_PIPE_TURN_RIGHT
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.XVelocity = 262144	//  0x40000
					Player.Animation = ANI_FANROTATE
				end if
			end if
		end if
		break

	case EFFECTRIGGER_PIPE_TURN_UP
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.YVelocity = -262144	// -0x40000
					Player.Animation = ANI_FANROTATE
				end if
			end if
		end if
		break

	case EFFECTRIGGER_PIPE_TURN_DOWN
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.YVelocity = 262144	//  0x40000
					Player.Animation = ANI_FANROTATE
				end if
			end if
		end if
		break

	case EFFECTRIGGER_UNUSED
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.XVelocity = 0
				end if
			end if
		end if
		break

	case EFFECTRIGGER_UNUSED_2
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.YVelocity = 0
				end if
			end if
		end if
		break

	case EFFECTRIGGER_PIPE_EXIT_PIPE
		PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
		if CheckResult == true
			if Player.State != PlayerObject_Death
				if Player.State != PlayerObject_Drown
					Player.YVelocity = 262144	//  0x40000
					
					

#platform: Use_Origins
				Player.State = PlayerObject_ResetDropDash
#endplatform

#platform: Use_Standalone
				Player.State = PlayerObject_HandleAir
#endplatform
					Player.Animation = ANI_WALKING
				end if
			end if
		end if
		break

	case EFFECTRIGGER_WATER_HEIGHT_2
		if Player.XPos > Object.XPos
			Stage.NewWaterLevel = 125829120	// 0x7800000, Y - 1920 in map coords
		else
			Stage.NewWaterLevel = 87293952	// 0x5340000, Y - 1332 in map coords
		end if
		break

	end switch
end sub

// ========================
// Editor Subs
// ========================

sub RSDKDraw
	DrawSprite(0)
end sub

sub RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-16, -16, 32, 32, 1, 143)		// #0 - "Script" Icon

	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end sub
