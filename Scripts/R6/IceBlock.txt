//------------------Sonic CD IceBlock Script------------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias Object.Value0	:	Object.Timer
#alias Object.Value1	:	Object.XVelocity
#alias Object.Value2	:	Object.YVelocity

// States
#alias 0				:	ICEBLOCK_FALLING
#alias 1				:	ICEBLOCK_BREAKICE

// Property Values
#alias 0				:	CHARACTER_ICEBLOCK
#alias 1				:	BIG_CHUNK_ICEBLOCK
#alias 2				:	MEDIUM_CHUNK_ICEBLOCK
#alias 3				:	CENTRAL_CHUNK_ICEBLOCK // Used, but it doesn't do anything
#alias 4				:	SMALL_CHUNK_ICEBLOCK

// Directions
#alias 2				:	FACING_UPWARDS
#alias 3				:	FACING_LEFT_UPWARDS

// Function declarations
#function IceBlock_CreateIceChunks


function IceBlock_CreateIceChunks
	CreateTempObject(TypeName[IceBlock], BIG_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].XPos -= 1114112
	Object[TempObjectPos].YPos -= 851968
	Object[TempObjectPos].XVelocity = -65536
	Object[TempObjectPos].YVelocity = -65536
	Object[TempObjectPos].Direction = FACING_RIGHT

	CreateTempObject(TypeName[IceBlock], BIG_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].XPos += 1114112
	Object[TempObjectPos].YPos -= 851968
	Object[TempObjectPos].XVelocity = 65536
	Object[TempObjectPos].YVelocity = -65536
	Object[TempObjectPos].Direction = FACING_LEFT

	CreateTempObject(TypeName[IceBlock], BIG_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].XPos -= 1114112
	Object[TempObjectPos].YPos += 851968
	Object[TempObjectPos].XVelocity = -65536
	Object[TempObjectPos].YVelocity = 65536
	Object[TempObjectPos].Direction = FACING_UPWARDS

	CreateTempObject(TypeName[IceBlock], BIG_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].XPos += 1114112
	Object[TempObjectPos].YPos += 851968
	Object[TempObjectPos].XVelocity = 65536
	Object[TempObjectPos].YVelocity = 65536
	Object[TempObjectPos].Direction = FACING_LEFT_UPWARDS

	CreateTempObject(TypeName[IceBlock], CENTRAL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].Direction = FACING_RIGHT

	CreateTempObject(TypeName[IceBlock], MEDIUM_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].YPos -= 1114112
	Object[TempObjectPos].YVelocity = -65536
	Object[TempObjectPos].Direction = FACING_LEFT

	CreateTempObject(TypeName[IceBlock], MEDIUM_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
	Object[TempObjectPos].DrawOrder = 4
	Object[TempObjectPos].YPos += 1114112
	Object[TempObjectPos].YVelocity = 65536
	Object[TempObjectPos].Direction = FACING_LEFT_UPWARDS
	
#platform: Use_Haptics
	HapticEffect(11, 0, 0, 0)
#endplatform
end function


sub ObjectMain
	switch Object.PropertyValue
	case CHARACTER_ICEBLOCK
		if Object.State == ICEBLOCK_FALLING
			Object.YPos += Object.YVelocity
			Object.YVelocity += Player.GravityStrength
			if Object.YVelocity > 1310720
				Object.YVelocity = 1310720
			end if

			ObjectTileCollision(0, 0, 24, 0)
			if CheckResult == true
				Object.State = ICEBLOCK_BREAKICE
				Object.YVelocity = 0
				PlayStageSfx(4, 0)
			end if

			Player.XPos = Object.XPos
			Player.YPos = Object.YPos
		else
			if Object.Timer < 16
				Object.Timer++
				if Object[0].Type == TypeName[PlayerObject]
					if Player.JumpPress == true
						CallFunction(IceBlock_CreateIceChunks)
						Object.Type = TypeName[Blank Object]

						CallFunction(PlayerObject_StartJump)

						Player.Visible = true
						Player.ObjectInteraction = true
					end if
				end if
			else
				CallFunction(IceBlock_CreateIceChunks)
				Object.Type = TypeName[Blank Object]

				Player.State = PlayerObject_HandleAir
				CallFunction(PlayerObject_Hit)

				Player.Visible = true
				Player.ObjectInteraction = true
			end if
		end if
		break

	case BIG_CHUNK_ICEBLOCK
		if Object.Timer < 10
			Object.Timer++
			Object.XPos += Object.XVelocity
			Object.YPos += Object.YVelocity
		else
			Object.Type = TypeName[Blank Object]
			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = 0
			Object[TempObjectPos].YVelocity = -65536

			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = -65536
			Object[TempObjectPos].YVelocity = 0

			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = 65536
			Object[TempObjectPos].YVelocity = 0

			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = 0
			Object[TempObjectPos].YVelocity = 65536
		end if
		break

	case MEDIUM_CHUNK_ICEBLOCK
		if Object.Timer < 16
			Object.Timer++
			Object.XPos += Object.XVelocity
			Object.YPos += Object.YVelocity
		else
			Object.Type = TypeName[Blank Object]
			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = 0
			Object[TempObjectPos].YVelocity = -65536

			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = -65536
			Object[TempObjectPos].YVelocity = 65536

			CreateTempObject(TypeName[IceBlock], SMALL_CHUNK_ICEBLOCK, Object.XPos, Object.YPos)
			Object[TempObjectPos].DrawOrder = 4
			Object[TempObjectPos].XVelocity = 65536
			Object[TempObjectPos].YVelocity = 65536
		end if
		break

	case CENTRAL_CHUNK_ICEBLOCK
		if Object.Timer < 1
			Object.Timer++
		else
			Object.Type = TypeName[Blank Object]
		end if
		break

	case SMALL_CHUNK_ICEBLOCK
		if Object.Timer < 12
			Object.Timer++
			Object.XPos += Object.XVelocity
			Object.YPos += Object.YVelocity
		else
			Object.Type = TypeName[Blank Object]
		end if
		break
	end switch
end sub


sub ObjectDraw
	DrawSpriteFX(Object.PropertyValue, FX_FLIP, Object.XPos, Object.YPos)
end sub


sub ObjectStartup
	if Stage.PlayerListPos == 0	// PlayerName[SONIC]
		LoadSpriteSheet("R6/Objects.gif")
		SpriteFrame(-24, -24, 48, 48, 34, 18)	// #0 - Sonic Ice Block
		SpriteFrame(-8, -12, 16, 24, 206, 1)	// #1 - Ice Chunk (Big)
		SpriteFrame(-8, -8, 16, 16, 66, 1)		// #2 - Ice Chunk (Medium)
		SpriteFrame(-8, -8, 16, 16, 66, 1)		// #3 - Ice Chunk (Medium)
		SpriteFrame(-4, -4, 8, 8, 34, 67)		// #4 - Ice Chunk (Small)
	else
		LoadSpriteSheet("R6/Objects3.gif")
		SpriteFrame(-24, -24, 48, 48, 1, 101)	// #0 - Sonic Ice Block
		SpriteFrame(-8, -12, 16, 24, 50, 86)	// #1 - Ice Chunk (Big)
		SpriteFrame(-8, -8, 16, 16, 50, 111)	// #2 - Ice Chunk (Medium)
		SpriteFrame(-8, -8, 16, 16, 50, 111)	// #3 - Ice Chunk (Medium)
		SpriteFrame(-4, -4, 8, 8, 50, 128)		// #4 - Ice Chunk (Small)
	end if
end sub

// ========================
// Editor Subs
// ========================

sub RSDKDraw
	DrawSprite(0)
end sub

sub RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-16, -16, 32, 32, 1, 143)		// #0 - "Script" Icon

	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end sub
