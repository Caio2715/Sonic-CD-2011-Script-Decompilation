//------------Sonic CD PohBee2 Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias 71: TYPE_POHBEE2


sub ObjectMain
	if Object.OutOfBounds == 1
		Object.State=6
		Object.Value0=0
		Object.Direction=FACING_RIGHT
		Object.XPos=Object.Value1
		Object.Value2=0
		Object.Value3=0
		Object.Value4=0
	end if
	if Object.PropertyValue == 0
		switch Object.State
		case 0
			Object.Priority=1
			if Object.Value3>0
				Object.Value3--
			end if
			if Object.Value0<256
				Object.Value0++
				Object.XPos -= 0x20000
			else
				Object.State=1
				Object.Value0=0
			end if
			break
		case 1
			Object.Priority=1
			if Object.Value3>0
				Object.Value3--
			end if
			if Object.Value0<30
				if Object.Value0 == 15
					Object.Direction=FACING_LEFT
				end if
				Object.Value0++
			else
				Object.State=2
			end if
			break
		case 2
			Object.Priority=1
			if Object.Value3>0
				Object.Value3--
			end if
			if Object.Value0<256
				Object.Value0++
				Object.XPos += 0x20000
			else
				Object.State=3
				Object.Value0=0
			end if
			break
		case 3
			Object.Priority=1
			if Object.Value3>0
				Object.Value3--
			end if
			if Object.Value0<30
				if Object.Value0 == 15
					Object.Direction=FACING_RIGHT
				end if
				Object.Value0++
			else
				Object.State=0
			end if
			break
		case 4
			Object.Priority=1
			if Object.Value3<46
				Object.Value3++
				if Object.Value3 == 15
					Object.Value4=4
				end if
				if Object.Value3 == 32
					CreateTempObject(TypeName[PohBeeBullet],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].XPos -= 0xF0000
					Object[TempObjectPos].YPos += 0x1B0000
					Object[TempObjectPos].Value1=-0x40000
					Object[TempObjectPos].Value2=0x40000
					PlayStageSfx(7,0)
				end if
			else
				Object.State=0
				Object.Value4=0
				Object.Value3=30
			end if
			break
		case 5
			Object.Priority=1
			if Object.Value3<46
				Object.Value3++
				if Object.Value3 == 15
					Object.Value4=4
				end if
				if Object.Value3 == 32
					CreateTempObject(TypeName[PohBeeBullet],0,Object.XPos,Object.YPos)
					Object[TempObjectPos].Direction=FACING_LEFT
					Object[TempObjectPos].XPos += 0xF0000
					Object[TempObjectPos].YPos += 0x1B0000
					Object[TempObjectPos].Value1=0x40000
					Object[TempObjectPos].Value2=0x40000
					PlayStageSfx(7,0)
				end if
			else
				Object.State=2
				Object.Value4=0
				Object.Value3=30
			end if
			break
		case 6
			if Object.OutOfBounds == 1
				Object.State=0
				Object.Priority=0
			end if
			break
		end switch
	else
		switch Object.State
		case 0
			Object.Priority=1
			if Object.Value0<512
				Object.Value0++
				Object.XPos -= 0x10000
			else
				Object.State=1
				Object.Value0=0
			end if
			break
		case 1
			Object.Priority=1
			if Object.Value0<30
				if Object.Value0 == 15
					Object.Direction=FACING_LEFT
				end if
				Object.Value0++
			else
				Object.State=2
			end if
			break
		case 2
			Object.Priority=1
			if Object.Value0<512
				Object.Value0++
				Object.XPos += 0x10000
			else
				Object.State=3
				Object.Value0=0
			end if
			break
		case 3
			Object.Priority=1
			if Object.Value0<30
				if Object.Value0 == 15
					Object.Direction=FACING_RIGHT
				end if
				Object.Value0++
			else
				Object.State=0
			end if
			break
		case 6
			if Object.OutOfBounds == 1
				Object.State=0
				Object.Priority=0
			end if
			break
		end switch
	end if
	CallFunction(StageSetup_Function47)
end sub


sub ObjectPlayerInteraction
	if Object.PropertyValue == 0
		if Object.State<4
			if Object.Value3 == 0
				PlayerObjectCollision(C_TOUCH,-96,-64,96,64)
				if CheckResult == 1
					if Object.XPos>Player.XPos
						Object.Direction=FACING_RIGHT
						Object.State=4
					else
						Object.Direction=FACING_LEFT
						Object.State=5
					end if
				end if
			end if
		end if
	end if
	if Object.State<6
		PlayerObjectCollision(C_TOUCH,-20,-16,20,14)
		if CheckResult == 1
			CallFunction(PlayerObject_Function40)
		end if
	end if
end sub


sub ObjectDraw
	if Object.State<6
		if Object.PropertyValue == 0
			Object.Value2++
			Object.Value2&=3
			Object.Frame=Object.Value2
			Object.Frame >>= 1
			Object.Frame += Object.Value4
		else
			Object.Value2++
			Object.Value2&=3
			Object.Frame=Object.Value2
			Object.Frame >>= 1
			Object.Frame += 2
		end if
		DrawSpriteFX(Object.Frame,FX_FLIP,Object.XPos,Object.YPos)
	end if
end sub


sub ObjectStartup
	LoadSpriteSheet("R6/Objects.gif")
	SpriteFrame(-24,-20,48,32,148,75)
	SpriteFrame(-24,-16,48,28,148,108)
	SpriteFrame(-24,-20,48,32,99,133)
	SpriteFrame(-24,-16,48,28,148,137)
	SpriteFrame(-24,-20,48,40,197,91)
	SpriteFrame(-24,-16,48,36,197,132)
	ArrayPos0=32
	while ArrayPos0<1056
		if Object[ArrayPos0].Type == TypeName[PohBee]
			Object[ArrayPos0].Type=TypeName[PohBee2]
		end if
		if Object[ArrayPos0].Type == TypeName[PohBee2]
			Object[ArrayPos0].Value1=Object[ArrayPos0].XPos
		end if
		ArrayPos0++
	loop
end sub


// ========================
// Editor Subs
// ========================

sub RSDKDraw
	DrawSprite(0)
end sub


sub RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-16, -16, 32, 32, 1, 143)		// #0 - "Script" Icon
	
	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end sub


