//------------Sonic CD Tube Switch Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias Object.Value0	:	Object.OnObject

// Player Aliases
#alias Player.Value6	:	Player.MinRollSpeed

// Gravity
#alias 0	:	GRAVITY_GROUND
#alias 1	:	GRAVITY_AIR

// Collision Modes
#alias 0	:	CMODE_FLOOR
#alias 1	:	CMODE_LWALL
#alias 2	:	CMODE_ROOF
#alias 3	:	CMODE_RWALL

// Property Values
#alias 1	:	TUBESWITCH_ENTER_H

// Player Aliases
#alias Player.Value2:Player.CustomAnimSpeed
#alias Player.Value6:Player.MinRollSpeed


sub ObjectPlayerInteraction
	PlayerObjectCollision(C_TOUCH, -16, -16, 16, 16)
	if CheckResult == true
		switch Object.PropertyValue
		case 0
			if Player.Speed > 0

				Player.Direction = FACING_RIGHT
				Player.State = PlayerObject_Tunnel
				Player.Animation = ANI_JUMPING
				Player.MinRollSpeed = 655360	// 0xA0000

				if Player.Speed < 655360		// 0xA0000
					Player.Speed = 655360		// 0xA0000
				end if

				if Player.Gravity == GRAVITY_AIR
					Player.Gravity = GRAVITY_GROUND
					Player.YPos = Object.YPos
				end if
			else
				if Player.Gravity == GRAVITY_GROUND

					if Player.Speed > -131072	// -0x20000
						Player.Speed = -131072	// -0x20000
					end if

				end if
				Player.State = PlayerObject_HandleRolling
				Player.Animation = ANI_JUMPING
			end if
			break

		case TUBESWITCH_ENTER_H
			if Player.Speed < 0

				Player.Direction = FACING_RIGHT
				Player.State = PlayerObject_Tunnel
				Player.Animation = ANI_JUMPING
				Player.MinRollSpeed = 655360	// 0xA0000

				if Player.Speed < 655360		// 0xA0000
					Player.Speed = 655360		// 0xA0000
				end if
			else
				if Player.Gravity == GRAVITY_GROUND

					if Player.Speed > -131072	// -0x20000
						Player.Speed = -131072	// -0x20000
					end if

				end if
				Player.State = PlayerObject_HandleRolling
				Player.Animation = ANI_JUMPING
			end if
			break

		case 2
			if Object.Value0 == 0
				if Player.Gravity == 1
					Player.Gravity = 0
					Player.State = PlayerObject_Tunnel
					Player.Animation = ANI_JUMPING
					Player.CollisionMode = 3
					Player.Angle = 64
					Player.Speed = 1048576
					Player.MinRollSpeed = 1048576
				else
					if Player.Speed > 0
						Player.Gravity = 0
						Player.State = PlayerObject_Tunnel
						Player.Animation = ANI_JUMPING
						Player.CollisionMode = 3
						Player.Angle = 64
						Player.Speed = 1048576
						Player.MinRollSpeed = 1048576
					else
						Player.Gravity = 1
						Player.YVelocity = Player.Speed
						Player.Speed = 0
						Player.XVelocity = 0
					end if
				end if
			end if
			break
		case 3
			if Object.Value0 == 0
				if Player.Gravity == 1
					Player.Gravity = 0
					Player.State = PlayerObject_Tunnel
					Player.Animation = ANI_JUMPING
					Player.CollisionMode = 3
					Player.Angle = 64
					Player.Speed = -655360
					Player.MinRollSpeed = 655360
				end if
				if Player.CollisionMode == 3
					if Player.Speed < 0
						Player.Gravity = 0
						Player.State = PlayerObject_Tunnel
						Player.Animation = ANI_JUMPING
						Player.CollisionMode = 3
						Player.Angle = 64
						Player.Speed = -655360
						Player.MinRollSpeed = 655360
					else
						Player.Gravity = 1
						Player.YVelocity = Player.Speed
						Player.Speed = 0
						Player.XVelocity = 0
					end if
				end if
			end if
			break
		case 4
			if Player.Gravity == 0
				Player.State = PlayerObject_HandleRolling
			else
				Player.XPos = Object.XPos
			end if
			if Player.Animation != ANI_JUMPING
				Player.Animation = ANI_JUMPING
				Player.CustomAnimSpeed = 240
			end if
			break
		case 5
			if Object.Value0 == 0
				if Player.YVelocity > 0
					Player.Gravity = 0
					Player.State = PlayerObject_Tunnel
					Player.Animation = ANI_JUMPING
					Player.CollisionMode = 3
					Player.Angle = 64
					Player.Speed = 1048576
					Player.MinRollSpeed = 1048576
				end if
			else
				if Player.State == PlayerObject_HandleAir
					Player.Animation = ANI_JUMPING
				end if
			end if
			break
		case 6
			if Object.Value0 == 0
				if Player.Gravity == 1
					Player.Gravity = 0
					Player.State = PlayerObject_Tunnel
					Player.Animation = ANI_JUMPING
					Player.CollisionMode = 3
					Player.Angle = 64
					Player.Speed = 1048576
					Player.MinRollSpeed = 1048576
				else
					Player.Gravity = 1
					Player.YVelocity = Player.Speed
					FlipSign(Player.YVelocity)
					Player.Speed = 0
					Player.XVelocity = 0
				end if
			end if
			break
		case 7
			if Object.Value0 == 0
				if Player.YVelocity > 0
					Player.Gravity = 0
					Player.State = PlayerObject_Tunnel
					Player.Animation = ANI_JUMPING
					Player.CollisionMode = 1
					Player.Angle = 192
					Player.Speed = -1048576
					Player.MinRollSpeed = 1048576
				end if
			else
				Player.Animation = ANI_JUMPING
			end if
			break
		case 8
			if Player.State != PlayerObject_HandleTailsFlight
				if Player.Gravity == 0
					Player.State = PlayerObject_HandleRolling
				end if
				Player.Animation = ANI_JUMPING
			end if
			break
		case 9
			if Object.Value0 == 0
				if Player.YVelocity > 0
					Player.Gravity = 0
					Player.State = PlayerObject_Tunnel
					Player.Animation = ANI_JUMPING
					Player.CollisionMode = 3
					Player.Angle = 64
					Player.Speed = 524288
					Player.MinRollSpeed = 524288
				end if
			else
				Player.Animation = ANI_JUMPING
			end if
			break
		case 10
			if Object.Value0 == 0
				if Player.Gravity == 0
					Player.Gravity = 1
					Player.YVelocity = Player.Speed
					Player.Speed = 0
					Player.XVelocity = 0
				end if
			end if
			break
		case 11
			if Player.YVelocity > 0
				if Player.XPos > Object.XPos
					TempValue0 = Player.XPos
					TempValue0 -= Object.XPos
					if TempValue0 < 393216
						Player.Gravity = 1
						Player.YVelocity = -196608
					end if
				else
					TempValue0 = Object.XPos
					TempValue0 -= Player.XPos
					if TempValue0 < 393216
						Player.Gravity = 1
						Player.YVelocity = -196608
					end if
				end if
			end if
			break
		case 12
			if Player.State != PlayerObject_HandleTailsFlight
				if Player.XVelocity > 262144
					if Player.Gravity == 0
						Player.State = PlayerObject_HandleRolling
					end if
					Player.Animation = ANI_JUMPING
				end if
			end if
			break
		end switch
		Object.Value0 = 1
	else
		Object.Value0 = 0
	end if
end sub

sub RSDK
	LoadSpriteSheet("Global/Display.gif")
	SetEditorIcon(Icon0, SingleIcon, -16, -16, 32, 32, 1, 143)
end sub
