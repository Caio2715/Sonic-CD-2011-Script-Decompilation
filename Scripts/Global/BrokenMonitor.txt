//------------Sonic CD BrokenMonitor Script-------------//
//--------Scripted by Christian Whitehead 'The Taxman'--------//
//-------Unpacked By Rubberduckycooly's Script Unpacker-------//

// Aliases
#alias Object.Value0			:	Object.PowerupPos
#alias Object.Value1			:	Object.Timer

// Power Up Aliases
#alias Object[2].Priority		:	PowerUp.Priority
#alias Object[2].DrawOrder		:	PowerUp.DrawOrder
#alias Object[2].XPos			:	PowerUp.XPos
#alias Object[2].YPos			:	PowerUp.YPos
#alias Object[2].PropertyValue	:	PowerUp.PropertyValue
#alias Object[2].InkEffect		:	PowerUp.InkEffect
#alias Object[2].Alpha			:	PowerUp.Alpha

// Player Aliases
#alias Player.Value0			:	Player.Rings
#alias Player.Value3			:	Player.SpeedShoes
#alias Player.Value4			:	Player.Invincible
#alias Player.Value5			:	Player.BlinkTimer

// OST
#alias 0						:	JP_OST

// Priorities
#alias 0						:	PRIORITY_ACTIVE_BOUNDS
#alias 1						:	PRIORITY_ACTIVE

// Ink Effects
#alias 2						:	INK_ALPHA

// Panning
#alias 0						:	PAN_RIGHT
#alias 1						:	PAN_LEFT

// States
#alias 0						:	BROKENMONITOR_SPAWN_POWERUP
#alias 1						:	BROKENMONITOR_FADE_POWERUP
#alias 2						:	BROKENMONITOR_BLANK

// Property Values
#alias 1						:	RING_MONITOR
#alias 2						:	SHIELD_MONITOR
#alias 3						:	INVINCIBILITY_MONITOR
#alias 4						:	POWER_SNEAKERS_MONITOR
#alias 5						:	SONIC_MONITOR
#alias 6						:	TIME_MONITOR
#alias 7						:	TAILS_MONITOR
#alias 8						:	S_MONITOR

// GameModes
#alias 2						:	GAMEMODE_TIMEATTACK


sub ObjectMain
	switch Object.State
	case BROKENMONITOR_SPAWN_POWERUP
		if Object.Timer < 0
			Object.PowerupPos += Object.Timer
			Object.Timer += 6144
		else
			Object.Timer = 0
		end if

		if Object.Timer == 0
			Object.State = BROKENMONITOR_FADE_POWERUP
			Object.InkEffect = INK_ALPHA
			switch Object.PropertyValue
			case RING_MONITOR
				Player.Rings += 10
				if Ring.Pan == PAN_RIGHT
					SetSfxAttributes(1, -1, -100)
					Ring.Pan = PAN_LEFT
				else
					SetSfxAttributes(2, -1, 100)
					Ring.Pan = PAN_RIGHT
				end if

				if Player.Rings > 999
					Player.Rings = 999
				end if

				if Player.Rings >= Ring.ExtraLife
					if Options.GameMode != GAMEMODE_TIMEATTACK
						Player.Lives++
						if Stage.PlayerListPos == 0		// PlayerName[SONIC]
							PlaySfx(20, 0)
						else
							PlaySfx(21, 0)
						end if
					end if

					Ring.ExtraLife += 100
					if Ring.ExtraLife > 300
						Ring.ExtraLife = 1000
					end if

					// King of the Rings Unlock Criteria
					if Player.Rings >= 200
						if Stage.PlayerListPos == 0		// PlayerName[SONIC]
							if Stage.DebugMode == false
								SetAchievement(4, 100)
							end if
						end if
					end if
				end if
				break

			case SHIELD_MONITOR
				PlaySfx(10, 0)
				PowerUp.PropertyValue = 1
				if Object[2].Type != TypeName[Invincibility]
					Object[2].Type = TypeName[BlueShield]
					PowerUp.Priority = PRIORITY_ACTIVE
					PowerUp.DrawOrder = 4
					PowerUp.InkEffect = INK_ALPHA
					PowerUp.Alpha = 160
					PowerUp.XPos = Player.XPos
					PowerUp.YPos = Player.YPos
				end if
				break

			case INVINCIBILITY_MONITOR
				Object[2].Type = TypeName[Invincibility]
				PowerUp.Priority = PRIORITY_ACTIVE
				PowerUp.DrawOrder = 4
				PowerUp.XPos = Player.XPos
				PowerUp.YPos = Player.YPos
				if Options.Soundtrack == JP_OST
					Player.Invincible = 1260
				else
					Player.Invincible = 1320
				end if
				Player.BlinkTimer = 0
				Player.Visible = true
				PlayMusic(2)
				break

			case POWER_SNEAKERS_MONITOR
				PlayMusic(3)
				Player.Acceleration = 6144		// 0x1800
				Player.AirAcceleration = 12288	// 0x3000
				Player.TopSpeed = 786432		// 0xC0000
				Player.SpeedShoes = 1320
				break

			case SONIC_MONITOR
				Player.Lives++
				PlaySfx(20, 0)
				break

			case TIME_MONITOR
				break

			case TAILS_MONITOR
				Player.Lives++
				PlaySfx(21, 0)
				break

			case S_MONITOR
				Object[2].Type = TypeName[Invincibility]
				PowerUp.Priority = PRIORITY_ACTIVE
				PowerUp.DrawOrder = 4
				PowerUp.XPos = Player.XPos
				PowerUp.YPos = Player.YPos
				Player.Invincible = 1320
				Player.BlinkTimer = 0
				Player.Visible = true
				Player.Acceleration = 6144		// 0x1800
				Player.AirAcceleration = 12288	// 0x3000
				Player.TopSpeed = 786432		// 0xC0000
				Player.SpeedShoes = 1320
				break

			end switch
		end if
		break

	case BROKENMONITOR_FADE_POWERUP
		Object.Timer++
		if Object.Timer == 30
			Object.Timer = 0
			Object.State = BROKENMONITOR_BLANK
			Object.PropertyValue = 0
			Object.Priority = PRIORITY_ACTIVE_BOUNDS
		else
			if Object.Timer > 14
				Object.Alpha -= 16
			end if
		end if
		break

	case BROKENMONITOR_BLANK
		break
	end switch
end sub


sub ObjectDraw
	DrawSprite(0)
	
	if Object.PropertyValue > 0
		DrawSpriteFX(Object.PropertyValue, FX_INK, Object.XPos, Object.PowerupPos)
	end if
end sub


sub ObjectStartup
	LoadSpriteSheet("Global/Items.gif")

	SpriteFrame(-16, 0, 32, 16, 51, 166)		// #0 - Broken Monitor
	
	// Icons
	SpriteFrame(-8, -8, 16, 16, 26, 7)			// #1 - Ring
	SpriteFrame(-8, -8, 16, 16, 26, 40)			// #2 - Blue Shield
	SpriteFrame(-8, -8, 16, 16, 26, 73)			// #3 - Invincibility
	SpriteFrame(-8, -8, 16, 16, 26, 106)		// #4 - Power Sneakers
	SpriteFrame(-8, -8, 16, 16, 26, 139)		// #5 - Sonic
	SpriteFrame(-8, -8, 16, 16, 26, 172)		// #6 - Time
	SpriteFrame(-8, -8, 16, 16, 59, 106)		// #7 - Tails
	SpriteFrame(-8, -8, 16, 16, 59, 139)		// #8 - S
end sub


// ========================
// Editor Subs
// ========================

sub RSDKDraw
	DrawSprite(0)
end sub


sub RSDKLoad
	LoadSpriteSheet("Global/Items.gif")

	SpriteFrame(-16, 0, 32, 16, 51, 166)		// #0 - Broken Monitor

	// Not to be used in-editor
	SetVariableAlias(ALIAS_VAR_PROPVAL, "unused")
end sub
